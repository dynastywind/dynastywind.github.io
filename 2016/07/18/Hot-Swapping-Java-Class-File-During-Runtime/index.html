<!DOCTYPE html>
<html >
<head>
  
    <!--[if lt IE 9]>
        <style>body {display: none; background: none !important} </style>
        <meta http-equiv="Refresh" Content="0; url=//outdatedbrowser.com/" />
    <![endif]-->

  <meta charset="utf-8">
  
  <title>Hot-Swapping Java Class File During Runtime | Dynastywind</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Hot-swapping class file is a popular technique in Java to provide class file replacement during runtime. This is a handy feature for developers that makes it possible to modify class files and test th">
<meta property="og:type" content="article">
<meta property="og:title" content="Hot-Swapping Java Class File During Runtime">
<meta property="og:url" content="http://blog.lyndonli.com/2016/07/18/Hot-Swapping-Java-Class-File-During-Runtime/index.html">
<meta property="og:site_name" content="Dynastywind">
<meta property="og:description" content="Hot-swapping class file is a popular technique in Java to provide class file replacement during runtime. This is a handy feature for developers that makes it possible to modify class files and test th">
<meta property="og:image" content="http://g.gravizo.com/g?
  digraph G {
      BootstrapClassLoader [shape=box]
      ExtClassLoader [shape=box]
      AppClassLoader [shape=box]
      CustomClassLoader [shape=box]
      BootstrapClassLoader -> ExtClassLoader
      ExtClassLoader -> AppClassLoader
      AppClassLoader -> CustomClassLoader
  }">
<meta property="og:updated_time" content="2016-07-18T13:59:30.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hot-Swapping Java Class File During Runtime">
<meta name="twitter:description" content="Hot-swapping class file is a popular technique in Java to provide class file replacement during runtime. This is a handy feature for developers that makes it possible to modify class files and test th">
<meta name="twitter:image" content="http://g.gravizo.com/g?
  digraph G {
      BootstrapClassLoader [shape=box]
      ExtClassLoader [shape=box]
      AppClassLoader [shape=box]
      CustomClassLoader [shape=box]
      BootstrapClassLoader -> ExtClassLoader
      ExtClassLoader -> AppClassLoader
      AppClassLoader -> CustomClassLoader
  }">
  
    <link rel="alternative" href="/atom.xml" title="Dynastywind" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
      <link href="//cdn.bootcss.com/animate.css/3.5.1/animate.min.css" rel="stylesheet">
  
  
      <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
      <link href="//cdn.bootcss.com/pace/1.0.2/themes/blue/pace-theme-minimal.css" rel="stylesheet">
  
  <link rel="stylesheet" href="/css/style.css">
  
  <link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  
  
      <link href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet">
  
  <script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
  <script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>
  <script>
      var yiliaConfig = {
          fancybox: true,
          animate: true,
          isHome: false,
          isPost: true,
          isArchive: false,
          isTag: false,
          isCategory: false,
          open_in_new: false,
          fancybox_js: "//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js",
          scrollreveal: "//cdn.bootcss.com/scrollReveal.js/3.1.4/scrollreveal.min.js",
          search: undefined
      }
  </script>

  
      <script>
          yiliaConfig.jquery_ui = [false];
      </script>
  

  
      <script>
          yiliaConfig.rootUrl = "/";
      </script>
  

  
  
</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            <img src="/img/avatar.png" class="animated zoomIn">
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/">Lyndon Li</a></h1>
        </hgroup>

        
        <p class="header-subtitle">Sapientia Et Virtus</p>
        

        


        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>Menu</li>
                        <li>Tags</li>
                        
                        <li>Friends</li>
                        
                        
                        <li>About Me</li>
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/">主页</a></li>
                        
                            <li><a href="/archives/">所有文章</a></li>
                        
                            <li><a href="/tags/">标签云</a></li>
                        
                            <li><a href="/about/">关于我</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" target="_blank" href="mailto:ligabriel12@gmail.com" title="Email"></a>
                            
                                <a class="fa 新浪微博" target="_blank" href="http://www.weibo.com/2167050524" title="新浪微博"></a>
                            
                                <a class="fa GitHub" target="_blank" href="https://github.com/dynastywind" title="GitHub"></a>
                            
                                <a class="fa RSS" target="_blank" href="/atom.xml" title="RSS"></a>
                            
                                <a class="fa 知乎" target="_blank" href="https://www.zhihu.com/people/tian-zhao-yi-feng" title="知乎"></a>
                            
                                <a class="fa Facebook" target="_blank" href="https://www.facebook.com/lyndon.li.58" title="Facebook"></a>
                            
                                <a class="fa Google" target="_blank" href="https://plus.google.com/108347049938082772852" title="Google"></a>
                            
                                <a class="fa Twitter" target="_blank" href="https://twitter.com/Dynastywind" title="Twitter"></a>
                            
                                <a class="fa LinkedIn" target="_blank" href="https://hk.linkedin.com/in/yi-li-32588099" title="LinkedIn"></a>
                            
                                <a class="fa StackOverflow" target="_blank" href="http://stackoverflow.com/users/5332733/lyndon" title="StackOverflow"></a>
                            
                                <a class="fa Instagram" target="_blank" href="https://www.instagram.com/lyndonli12" title="Instagram"></a>
                            
                                <a class="fa Flickr" target="_blank" href="https://www.flickr.com/people/136533643@N02" title="Flickr"></a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Alibaba-Tair/">Alibaba Tair</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Class-Loader/">Class Loader</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GitHub/">GitHub</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hexo/">Hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hot-Swap/">Hot-Swap</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Installation-Guide/">Installation Guide</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/回忆/">回忆</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/香港/">香港</a></li></ul>
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="https://hexo.io">Hexo</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="https://pages.github.com/">GitHub</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://moxfive.xyz/">MOxFIVE</a>
                    
                    </div>
                </section>
                

                
                
                <section class="switch-part switch-part4">
                
                    <div id="js-aboutme">专注于前端</div>
                </section>
                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">Lyndon Li</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                <img src="/img/avatar.png" class="animated zoomIn">
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页">Lyndon Li</a></h1>
            </hgroup>
            
            <p class="header-subtitle">Sapientia Et Virtus</p>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/">主页</a></li>
                
                    <li><a href="/archives/">所有文章</a></li>
                
                    <li><a href="/tags/">标签云</a></li>
                
                    <li><a href="/about/">关于我</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" target="_blank" href="mailto:ligabriel12@gmail.com" title="Email"></a>
                            
                                <a class="fa 新浪微博" target="_blank" href="http://www.weibo.com/2167050524" title="新浪微博"></a>
                            
                                <a class="fa GitHub" target="_blank" href="https://github.com/dynastywind" title="GitHub"></a>
                            
                                <a class="fa RSS" target="_blank" href="/atom.xml" title="RSS"></a>
                            
                                <a class="fa 知乎" target="_blank" href="https://www.zhihu.com/people/tian-zhao-yi-feng" title="知乎"></a>
                            
                                <a class="fa Facebook" target="_blank" href="https://www.facebook.com/lyndon.li.58" title="Facebook"></a>
                            
                                <a class="fa Google" target="_blank" href="https://plus.google.com/108347049938082772852" title="Google"></a>
                            
                                <a class="fa Twitter" target="_blank" href="https://twitter.com/Dynastywind" title="Twitter"></a>
                            
                                <a class="fa LinkedIn" target="_blank" href="https://hk.linkedin.com/in/yi-li-32588099" title="LinkedIn"></a>
                            
                                <a class="fa StackOverflow" target="_blank" href="http://stackoverflow.com/users/5332733/lyndon" title="StackOverflow"></a>
                            
                                <a class="fa Instagram" target="_blank" href="https://www.instagram.com/lyndonli12" title="Instagram"></a>
                            
                                <a class="fa Flickr" target="_blank" href="https://www.flickr.com/people/136533643@N02" title="Flickr"></a>
                            
                        </ul>
            </nav>
        </header>                
    </div>
    <link class="menu-list" tags="Tags" friends="Friends" about="About Me"/>
</nav>
      <div class="body-wrap"><article id="post-Hot-Swapping-Java-Class-File-During-Runtime" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/07/18/Hot-Swapping-Java-Class-File-During-Runtime/" class="article-date">
      <time datetime="2016-07-18T13:59:30.000Z" itemprop="datePublished">2016-07-18</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Hot-Swapping Java Class File During Runtime
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/Technology/">Technology</a><a class="article-category-link" href="/categories/Technology/Java/">Java</a>
    </div>


        
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Class-Loader/">Class Loader</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Hot-Swap/">Hot-Swap</a></li></ul>
    </div>

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>Hot-swapping class file is a popular technique in Java to provide class file replacement during runtime. This is a handy feature for developers that makes it possible to modify class files and test their functions on the fly without recompiling the whole project. And it also serves as a base function when implementing automatic system upgrade. This passage mainly focuses on the core technique required to acheive class file hot-swapping, the <strong>Class Loaders</strong> in Java, and a naive implementation of class file hot-swapping.<br><a id="more"></a></p>
<h2 id="Java-Class-Loader"><a href="#Java-Class-Loader" class="headerlink" title="Java Class Loader"></a>Java Class Loader</h2><p>Before we get into the implementation of class file hot-swapping, it’s necessary to have an understanding of class loader technique in Java as it’s the solid pillar underneath the grand hall.</p>
<p>As you may know, Java has a hierarchical class loader architecture, which can be depicted as below.</p>
<p><img src="http://g.gravizo.com/g?
  digraph G {
      BootstrapClassLoader [shape=box]
      ExtClassLoader [shape=box]
      AppClassLoader [shape=box]
      CustomClassLoader [shape=box]
      BootstrapClassLoader -&gt; ExtClassLoader
      ExtClassLoader -&gt; AppClassLoader
      AppClassLoader -&gt; CustomClassLoader
  }" alt="Java Class Loader Hierarchy"></p>
<p>From top level to the bottom, they’re namely <strong>BootstrapClassLoader</strong>, <strong>ExtClassLoader</strong>, <strong>AppClassLoader</strong> and <strong>CustomClassLoader</strong>. They’re responsbile for different kinds of class loading tasks. Below demonstrates a general picture.</p>
<p><strong>BootstrapClassLoader:</strong> The toppest level class loader, which reads all class files under <em>sun.boot.class.path</em>. This path defaultly includes all core Java APIs under <em>jre/lib</em> directory and all jar files under the directories that are specified using <em>-Xbootclasspath</em> parameter when the program is loaded into JVM. If lower level class loaders can’t find a specified class file, this one would be the last resort by default.</p>
<p><strong>ExtClassLoader:</strong> As we know that Java has a variety of extension libraries provided in JRE under <em>jre/lib/ext</em> directory. So in addition to core APIs, JVM will search for this path to load extension jar or class files by default. This task is handled by <strong>ExtClassLoader</strong>, which will look for class files defined in <em>java.ext.dirs</em>. Also you can provide your own paths that containing your extension class files by specifing the value of <em>-Djava.ext.dirs</em> to overwrite the default one.</p>
<p><strong>AppClassLoader:</strong> This class loader takes charge in all class files defined under <em>java.class.path</em>. The default value is defined in <strong>CLASSPATH</strong> environment variable. And you can modify it either by changing this variable or specify your own with <em>-classpath</em>.</p>
<p><strong>CustomClassLoader:</strong> Althogh it’s the bottom level class loader, it’s the most powerful one as you can define your own class loading mechanism here to do whatever you want to do.</p>
<p>In order to load a class, JVM will firstly search the class loader hierarchy from bottom to the top to see if a class has been loaded or not. If it has been loaded, then returns the reference to this class. If all class loaders haven’t loaded this class, JVM will try to load this class from top to bottom. If this fails after trying with all class loaders, an exception will be thrown. Since each class loader has its own namespace, classes with same name can only be loaded once in a class loader.</p>
<p>If we don’t provide our own class loader, our code will be loaded using <strong>AppClassLoader</strong> by default, which means a class file can only be loaded once despite of any changes on its content. To overcome this, we need to implement our own class loader so that different versions of a same class file can be loaded dynamically.</p>
<h2 id="Customized-Class-Loader"><a href="#Customized-Class-Loader" class="headerlink" title="Customized Class Loader"></a>Customized Class Loader</h2><p>Althogh customized class loader can be powerful, we still need to obey its rules. Since a class can only be loaded by a class loader only once, in order to load a same class file with different version, we need to create a different class loader. As a result, the default system class loaders can’t be involved in our implementation. And because we want to JVM know that our class loader is a <strong>class loader</strong> so that it can be used by the JVM to read class files, we also need to extend our class from an abstract class <strong>ClassLoader</strong> which is provided by Java.</p>
<p>Below is our implementation of customized class loader.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HotSwapClassLoader</span> <span class="keyword">extends</span> <span class="title">ClassLoader</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String baseDir;</span><br><span class="line">    <span class="keyword">private</span> Set&lt;String&gt; classNames;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HotSwapClassLoader</span><span class="params">(String baseDir, String[] classNames)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(<span class="keyword">null</span>); <span class="comment">// Set parent class loader to null since we don't want system class loader to load our class</span></span><br><span class="line">        <span class="keyword">this</span>.baseDir = baseDir;</span><br><span class="line">        <span class="keyword">this</span>.classNames = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line">        loadClass(classNames);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Entry method for loading a class. All explicit class loading is implemented by this method.</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> Class <span class="title">loadClass</span><span class="params">(String name, <span class="keyword">boolean</span> resolve)</span> <span class="keyword">throws</span> ClassNotFoundException </span>&#123;</span><br><span class="line">        Class clazz = findLoadedClass(name); <span class="comment">// To find if this class has been loaded or not</span></span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">this</span>.classNames.contains(name) &amp;&amp; <span class="keyword">null</span> == clazz) &#123;</span><br><span class="line">            clazz = getSystemClassLoader().loadClass(name); <span class="comment">// Delegate class files we're not intrested in to system class loaders</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span> == clazz) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ClassNotFoundException(name);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(resolve) &#123;</span><br><span class="line">            resolveClass(clazz); <span class="comment">// Link a class file to make sure it's usable</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> clazz;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">loadClass</span><span class="params">(String[] classNames)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(String className : classNames) &#123;</span><br><span class="line">            loadDirectly(className);</span><br><span class="line">            <span class="keyword">this</span>.classNames.add(className);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">loadDirectly</span><span class="params">(String name)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        StringBuffer sb = <span class="keyword">new</span> StringBuffer(<span class="keyword">this</span>.baseDir);</span><br><span class="line">        String className = name.replace(<span class="string">'.'</span>, File.separatorChar) + <span class="string">".class"</span>;</span><br><span class="line">        sb.append(File.separator + className);</span><br><span class="line">        File classFile = <span class="keyword">new</span> File(sb.toString());</span><br><span class="line">        <span class="keyword">byte</span>[] raw = <span class="keyword">new</span> <span class="keyword">byte</span>[(<span class="keyword">int</span>)classFile.length()];</span><br><span class="line">        InputStream is = <span class="keyword">new</span> FileInputStream(classFile);</span><br><span class="line">        is.read(raw);</span><br><span class="line">        is.close();</span><br><span class="line">        defineClass(name, raw, <span class="number">0</span>, raw.length); <span class="comment">// Accept a byte array of class data and transform it to a class</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The general idea of this implementation is that we load all requried class files during the instantiation period of our class loader and delegate others to system class loaders. With this in hand, now we’re able to acheive our goal: <strong>class file hot-swapping</strong>.</p>
<h2 id="Class-File-Hot-Swapping"><a href="#Class-File-Hot-Swapping" class="headerlink" title="Class File Hot-Swapping"></a>Class File Hot-Swapping</h2><p>In order to make an experiment, we create a simple class file first which will be replaced by newer version later.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Foo</span> </span>&#123; </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sayHello</span><span class="params">()</span> </span>&#123; </span><br><span class="line">        System.out.println(<span class="string">"Hello world! V1.0"</span>); </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>We compile this java file first and put it under the <em>resources</em> directory of our project. Then we create a new thread to load that class and invoke its <em>sayHello</em> method every two seconds.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    HotSwapClassLoader loader = <span class="keyword">new</span> HotSwapClassLoader(<span class="string">"hotswap/src/main/resources/"</span>, <span class="keyword">new</span> String[] &#123;<span class="string">"Foo"</span>&#125;);</span><br><span class="line">    Class clazz = loader.loadClass(<span class="string">"Foo"</span>);</span><br><span class="line">    Object foo = clazz.newInstance();</span><br><span class="line">    Method method = foo.getClass().getMethod(<span class="string">"sayHello"</span>);</span><br><span class="line">    method.invoke(foo);</span><br><span class="line">    Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Note that each time we load this class there’s a new instance of class loader generated first. Because, as is mentioned before, class files with the same qualified name can only be loaded into a class loader once.</p>
<p>Now we run the program and change the version in <em>Foo</em> to <em>V2.0</em>, you will see an output similar to below.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Hello world! V1.0</span><br><span class="line">Hello world! V1.0</span><br><span class="line">Hello world! V1.0</span><br><span class="line">Hello world! V1.0</span><br><span class="line">Hello world! V2.0</span><br><span class="line">Hello world! V2.0</span><br></pre></td></tr></table></figure>
<p>The class <em>Foo</em> has been hot-swapped successfully during runtime.</p>
<h2 id="Notice"><a href="#Notice" class="headerlink" title="Notice"></a>Notice</h2><p>That’s it. Althogh our example is quite simple, we have a workable hot-swap class loader now for demonstration purpose. But when considering the production environment, things can be more tricky. Our naive implementation of hot-swap class loader can never be applied onto this environment due to performance issue. As is mentioned earlier, we’ll create a new instance of our class loader every two seconds. This behavior is redundant and a wast of resource even though we enlarge the sleeping cycle. We need to modify it to do the same work only when it is needed. Hence, if you’re desining your production system, you need more work and consideration.</p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>This passage has discussed basic technologies covered in <em>class file hot-swapping in Java</em>. This topic can be very complicated if we involve other aspects like system auto-upgrading/auto-downgrading, and concrete implementation should depend on detailed requirements. Besides above, more details should be digged out by readers yourselves. Let’s keep moving forward!</p>

      
    </div>
    
  </div>
  
    
    <div class="copyright">
        <p><span>Title:</span><a href="/2016/07/18/Hot-Swapping-Java-Class-File-During-Runtime/">Hot-Swapping Java Class File During Runtime</a></p>
        <p><span>Author:</span><a href="/" title="Back to Homepage">Lyndon Li</a></p>
        <p><span>Created:</span>2016-07-18, 22:59:30</p>
        <p><span>Updated:</span>2016-07-18, 22:59:30</p>
        <p>
            <span>Full URL:</span><a class="post-url" href="/2016/07/18/Hot-Swapping-Java-Class-File-During-Runtime/" title="Hot-Swapping Java Class File During Runtime">http://blog.lyndonli.com/2016/07/18/Hot-Swapping-Java-Class-File-During-Runtime/</a>
            <span class="copy-path" data-clipboard-text="From http://blog.lyndonli.com/2016/07/18/Hot-Swapping-Java-Class-File-During-Runtime/　　By Lyndon Li" title="Copy Article&#39;s Link &amp; Author"><i class="fa fa-clipboard"></i></span>
            <script> var clipboard = new Clipboard('.copy-path'); </script>
        </p>
        <p>
            <span>License:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" title="CC BY-NC-SA 4.0 International" target = "_blank">"CC BY-NC-SA 4.0"</a> Keep Link &amp; Author if Distribute.
        </p>
    </div>



    <nav id="article-nav">
        
        
            <div id="article-nav-older" class="article-nav-title">
                <a href="/2016/05/28/Install-Alibaba-Tair/">
                    Install Alibaba Tair
                </a>
            </div>
        
    </nav>

  
</article>

    <div id="toc" class="toc-article">
    <strong class="toc-title">Contents</strong>
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Java-Class-Loader"><span class="toc-number">1.</span> <span class="toc-text">Java Class Loader</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Customized-Class-Loader"><span class="toc-number">2.</span> <span class="toc-text">Customized Class Loader</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Class-File-Hot-Swapping"><span class="toc-number">3.</span> <span class="toc-text">Class File Hot-Swapping</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Notice"><span class="toc-number">4.</span> <span class="toc-text">Notice</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Conclusion"><span class="toc-number">5.</span> <span class="toc-text">Conclusion</span></a></li></ol>
</div>
<style>
    .left-col .switch-btn {
        display: none;
    }
    .left-col .switch-area {
        display: none;
    }
</style>

<input type="button" id="tocButton" value="Hide"  title="Show or Hide Table of Contents">
<script>
    var valueHide = "Hide";
    var valueShow = "Show";

    if ($(".left-col").is(":hidden")) {
        $("#tocButton").attr("value", valueShow);
    }

    $("#tocButton").click(function() {
        if ($("#toc").is(":hidden")) {
            $("#tocButton").attr("value", valueHide);
            $("#toc").slideDown(320);
            $(".switch-btn, .switch-area").fadeOut(300);
        }
        else {
            $("#tocButton").attr("value", valueShow);
            $("#toc").slideUp(350);
            $(".switch-btn, .switch-area").fadeIn(500);
        }
    })

    if ($(".toc").length < 1) {
        $("#toc, #tocButton").hide();
        $(".switch-btn, .switch-area").show();
    }
</script>





    
<div class="share">
    
        <div class="bdsharebuttonbox">
            <a href="#" class="fa fa-twitter bds_twi" data-cmd="twi" title="分享到推特"></a>
            <a href="#" class="fa fa-weibo bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
            <a href="#" class="fa fa-qq bds_sqq" data-cmd="sqq" title="分享给 QQ 好友"></a>
            <a href="#" class="fa fa-files-o bds_copy" data-cmd="copy" title="复制网址"></a>
            <a href="#" class="fa fa fa-envelope-o bds_mail" data-cmd="mail" title="通过邮件分享"></a>
            <a href="#" class="fa fa-weixin bds_weixin" data-cmd="weixin" title="生成文章二维码"></a>
            <a href="#" class="fa fa-share-alt bds_more" data-cmd="more"></i></a>
        </div>
        <script>
            window._bd_share_config={
                "common":{"bdSnsKey":{},"bdText":"Hot-Swapping Java Class File During Runtime　| Dynastywind　","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"24"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
        </script>
    

    
</div>







    
        <section id="comments">
  <div id="disqus_thread"></div>
    <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'bloglyndonli'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</section>
    




    <div class="scroll" id="post-nav-button">
        
            <a href="/" title="Back to Homepage"><i class="fa fa-home"></i></a>
        

        <a title="Mini Archives"><i class="fa fa-bars"></i><i class="fa fa-times"></i></a>

        
            <a href="/2016/05/28/Install-Alibaba-Tair/" title="Next: Install Alibaba Tair">
                <i class="fa fa-angle-right"></i>
            </a>
        
    </div>

    <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/07/18/Hot-Swapping-Java-Class-File-During-Runtime/">Hot-Swapping Java Class File During Runtime</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/05/28/Install-Alibaba-Tair/">Install Alibaba Tair</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/04/香港记忆/">香港记忆</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/12/21/Establish-Hexo-with-GitHub/">Establish Hexo with GitHub</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/12/15/hello-world/">Hello World</a></li></ul>




    <script>
        
    </script>
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                <i class="fa fa-copyright"></i> 
                2015-2016 Lyndon Li
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank" title="A fast, simple &amp; powerful blog framework">Hexo</a>  Theme <a href="https://github.com/MOxFIVE/hexo-theme-yelee" target="_blank" title="Another simple and elegant theme for Hexo  v3.0">Yelee</a> by MOxFIVE <i class="fa fa-heart animated infinite pulse"></i>
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style='display:none'>
                        <span id="site-visit" >Site Visitors: 
                            <span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>, </span>
                
                
                    <span id="busuanzi_container_page_pv" style='display:none'>
                        <span id="page-visit">Page Hits: 
                            <span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div>
</footer>
    </div>
    
<script data-main="/js/main.js" src="//cdn.bootcss.com/require.js/2.2.0/require.min.js"></script>

    <script>
        $(document).ready(function() {
            var iPad = window.navigator.userAgent.indexOf('iPad');
            if (iPad > -1 || $(".left-col").css("display") === "none") {
                var bgColorList = ["#9db3f4", "#414141", "#e5a859", "#f5dfc6", "#c084a0", "#847e72", "#cd8390", "#996731"];
                var bgColor = Math.ceil(Math.random() * (bgColorList.length - 1));
                $("body").css({"background-color": bgColorList[bgColor], "background-size": "cover"});
            }
            else {
                var backgroundnum = 5;
                var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
                $("body").css({"background": backgroundimg, "background-attachment": "fixed", "background-size": "cover"});
            }
        })
    </script>


<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-33590201-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->



<div class="scroll" id="scroll">
    <a href="#" title="Back to Top"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" title="Comments"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="Go to Bottom"><i class="fa fa-arrow-down"></i></a>
</div>
<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
  </div>
</body>
</html>